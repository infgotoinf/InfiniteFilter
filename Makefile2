#
# Cross Platform Makefile
# Compatible with MSYS2/MINGW, Ubuntu 14.04.1 and Mac OS X
#
# You will need SDL2 (http://www.libsdl.org):
# Linux:
#   apt-get install libsdl2-dev
# Mac OS X:
#   brew install sdl2
# MSYS2:
#   pacman -S mingw-w64-i686-SDL2
#

CXX  = g++
#CXX = clang++

EXE  =
RELEASE = Infinite Filter
DEBUG   = Infinite_Filter_DEBUG

IMGUI_DIR = ./imgui
SDL2_DIR  = ./SDL2
BUILD_DIR = ./build

SOURCES  := $(shell find $(SRC_DIRS) -name '*.cpp' -or -name '*.c' -or -name '*.s')
OBJS 	 := $(SRCS:%=$(BUILD_DIR)/%.o)
UNAME_S  := $(shell uname -s)

CXXFLAGS         = -std=c++11 -I$(IMGUI_DIR) -I$(IMGUI_DIR)/backends -I$(SDL2_DIR)
RELEASE_CXXFLAGS = -Ofast -fno-rtti -flto -ffunction-sections -fdata-sections
DEBUG_CXXFLAGS   = -g -Wall -W -Wshadow -Wformat

##---------------------------------------------------------------------
## BUILD RULES
##---------------------------------------------------------------------

$(BUILD_DIR)/$(DEBUG): $(OBJS)
	$(CXX) $(OBJS) -o $@

$(BUILD_DIR)/%.cpp.o: $(SOURCES)
	mkdir -p $(BUILD_DIR)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o $@

all:
	@echo $(CXXFLAGS)
	@echo $(EXE)
	@echo $(OBJS)
	@echo $(SOURCES)

RELEASE: CXXFLAGS += $(RELEASE_CXXFLAGS)
RELEASE: EXE = $(RELEASE)
RELEASE: all
	@echo Release build was choosen

DEBUG: CXXFLAGS += $(DEBUG_CXXFLAGS)
DEBUG: EXE = $(DEBUG)
DEBUG: all
	@echo Debug build was choosen


.PHONY: clean
clean:
	rm -r $(OBJS)